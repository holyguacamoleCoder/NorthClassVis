# 设计模式

这里简单解释笔者开发项目使用到的设计模式的原因和一些思考
只是经验之谈，理解可能有缺陷，请各位指正

## 单例模式

在config.py中，Config类使用单例模式，保证全局唯一。

**为什么要使用单例模式？**
保证Config全局唯一，避免重复加载数据或者路由之间数据不一致，提高性能。

## 工厂模式

在backend/tools/feature_factory.py中，FeatureFactory类使用工厂模式，根据传入的参数创建不同的特征计算类。

**为什么要用工厂模式？**

1. 减少代码量，减少重复代码
2. 有相当一部分路由需要重用计算的步骤，因此需要将这些步骤封装起来，其实就是1.

## 依赖注入

## 观察者模式

在main.py中，使用了观察者模式，当路由发生变化时，会自动通知所有观察者，进行相应处理。

**为什么要用观察者模式？**
观察者模式可以更好的管理依赖关系，当依赖关系发生变化时，可以自动通知所有观察者，进行相应处理。
这恰好对应了前段筛选数据的变化，当筛选条件发生变化时，需要重新计算特征值，然后各个路由更新数据的需求。

**为什么只添加不分路由或类为被观察对象呢？**

1. Scatter和Portrait没有使用观察者模式 而是FeatureFactory内部直接运算，可以更好体会依赖变动的两种实现方案
   - 一是观察者模式，A变动，通知所有观察者，观察者再进行相应处理
   - 二是依赖注入，内部直接运算，A变动，收影响的所有类内部会自动运行函数获取新的数据
2. Nav路由没有使用观察者模式，因为Nav路直接导致了config的修改，然后通知其他观察者，本质上观察config就是观察nav
